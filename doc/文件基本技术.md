# 文件基本技术

## 二进制思维

所有文件,不管是可执行文件,音频文件,文本文件等等,都是以0和1的二进制形式保存的,因为计算机只能识别二进制,那我们所看到的界面呈现,都是应用程序对这些二进制数据的解析结果,比如使用图片查看器查看图片,使用音频软件听音乐,使用视频软件看视频等等..都是应用程序对二进制进行解析,进而呈现给用户直观的感受.

## 查看二进制数据

使用 UltraEdit 编辑器可查看文本对应的十六进制数据.

## 文件类型

上面说到,计算机系统中,所有文件都是由二进制进行存储,最终由应用程序解析,最终呈现给用户,那么为了便于处理文件,文件就有了文件类型的概念,,比如 图片查看器专门用来处理 .jpg/.png 等后缀的文件类型

##　文本文件的编码

文本文件中包含的基本都是可打印字符,字符到二进制的映射　(即编码)　却有多种方式，如UTF-8,GBK, linux系统默认的编码方式为 UTF-8,而window默认一般为GBK,而对于UTF-8编码比较特殊,分为有BOM头的编码方式和无BOM头的编码方式,有BOM头就是在文件最开头加入三个特殊字节(0xEF 0xBB 0xBF) 这三个特殊字符为BOM头,BOM是 Byte Order Mark(即字节序标记) 的缩写....  但是加了BOM跟没加BOM,最终文本界面解析后看到的效果是一样的,但二进制内容不一样,一个带BOM头,一个不带BOM头,   **不是所有的应用程序都支持带BOM头的UTF-8编码文件,碰到不支持的时候,建议看下文件背后的二进制**

window 中文本文件换行符 `\r\n`  linux中为 `\n`

## 文件系统

文件一般是放置在计算机硬盘中,一个机器上可能有多个硬盘,但各种操作系统都会隐藏物理硬盘概念,提供一个逻辑的统一结构. linux 系统中一般只有一个逻辑盘,用 `/` 表示,系统的根目录,所有的子目录跟文件都在 `/` 下,构成一个目录树.

绝对路径:从根目录到当前目录的完整路基 如:/home/zhangsl

相对路径:相对于当前目录而言, 在 linux 中,`.`表示当前目录路径   `..` 表示上一层级目录

文件属性:文件名,创建时间,修改时间,文件大小等   是否隐藏文件,,,在linux系统中,以`.`开头的文件名则为隐藏文件,如.gitignore

linux 系统中 文件名大小写敏感, aaa.txt 和AAA.txt 视为不同的文件,,而在window中是不敏感的  视为相同文件

临时目录:操作系统一般会有一个临时目录,Linux 系统中临时目录为 /tmp   是系统级别的临时目录,,用于应用程序产生的临时文件,,操作系统有一定的策略会清理不用的临时文件

## 文件读写

文件是放在系统硬盘中的,程序解析文件需要将数据读入内存,修改后,需要写回硬盘..操作系统提供了对文件读写的基本API,不同操作系统的接口和实现不一样,不过,有一些概念是一致的,Java 封装了操作系统的功能,提供了统一的API.

**常识一:**

硬盘的访问延时,相比内存,是很慢的....       操作系统和硬盘一般是按照块批量传输,而不是按字节,以摊延时开销,块大小一般至少为512字节,即使应用程序只需要文件的一个字节,操作系统也会至少将一个块读进来,...一般而言,应该尽量减少接触硬盘,接触一次,就一次多做一些事情....对于网络请求和其他输入输出设备 ,原则都是类型的.

**常识二:**

一般读写文件需要两次数据复制,比如读文件,需要先从硬盘复制到操作系统内核 ,再从内核复制到应用程序分配的内存中...   操作系统运行所在的环境和应用程序是不一样的,操作系统所在的环境是内核态,应用程序是用户态,应用程序调用操作系统的功能,需要两次环境的切换,先从用户态切到内核态,再从内核态切到用户态..这种用户态/内核态的切换是有开销的,应尽量减少这种切换..

为了提升文件操作的效率,应用程序经常使用一种常见的策略,即使用缓冲区.. 读文件时,即使目前只需要少量的内容,但预知还会接着读取,就一次读取比较多的内容,放到读缓冲区,下次读取时,如果缓冲区有,就直接从缓冲区读,减少访问操作系统和硬盘..写文件时,先写到写缓冲区,,写缓冲区满了之后,再一次性调用操作系统写到硬盘..不过  需要注意的是,在写结束的时候,要记住将缓冲区的剩余内容同步到硬盘..操作系统自身也会使用缓冲区..不过 应用程序更了解读写模式 恰当使用往往可以 有更高的效率.

操作系统操作文件一般有打开和关闭的概念,,打开文件会在操作系统内核建立一个有关该文件的内存结构,这个结构一般通过一个整数索引来引用..这个索引一般称为文件描述符..  这个结构消耗内存的  操作系统能同时打开的文件一般也是有限的  在不同文件的时候,应该记住关闭文件  关闭文件一般会同步缓冲区内容到硬盘  并释放占据的内存结构.

操作系统一般支持一种称为内存映射文件的高效的随机读写大文件的方法  将文件直接映射到内存,操作内存就是操作文件,,在内存映射文件中,只有访问到的数据才会被实际复制到内存 且数据只会复制一次,,被操作系统以及多个应用程序共享..







